{"createdAt":"2025-06-06T10:20:49.511Z","updatedAt":"2025-07-05T02:47:53.254Z","id":"F3Kw0oiMCmMBMPXm","name":"06 - CRIA IMAGENS","active":true,"isArchived":false,"nodes":[{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-5580,180],"id":"bc9ab06b-f722-400a-afb3-e69fdbb18f8e","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"n4WalwSU2foIXybD","name":"OpenAi account"}}},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":20}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-6920,-60],"id":"bdcb56c9-97af-47df-88df-da66b6ae4500","name":"Iniciar Verificação Periódica"},{"parameters":{"resource":"list","operation":"getCards","id":"={{ $item(\"0\").$node[\"Edit Fields\"].json[\"ÁUDIOS LONGOS\"] }}","returnAll":true,"additionalFields":{}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-6480,-60],"id":"66593fa2-2227-4cdf-971e-a5e3da707819","name":"Buscar Cartões com Solicitações de Imagem","credentials":{"trelloApi":{"id":"rpm3uMep21rqpid6","name":"Trello account"}}},{"parameters":{},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[-6040,-60],"id":"38e8fb85-faed-4f75-9021-a4a89b4d6322","name":"Selecionar Próximo Cartão da Fila"},{"parameters":{"promptType":"define","text":"={{ $json.desc }}","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-5600,-60],"id":"5556e050-7021-401a-bb0b-429fd1e09c77","name":"Extrair Dados do Cartão"},{"parameters":{"jsonSchemaExample":"{\n\"título\": \"{{ $('Edit Fields2').item.json['título'] }}\",\n\"seo\": \"{{ $('Edit Fields2').item.json.seo }}\",\n\"pasta\": \"{{ $('Edit Fields2').item.json.pasta }}\",\n\"card\": \"{{ $('Edit Fields2').item.json.card }}\",\n\"audiolongo1\": \"{{ $('Edit Fields2').item.json.audiolongo1 }}\",\n\"audiolongo2\": \"{{ $('Edit Fields2').item.json.audiolongo2 }}\",\n\"audiolongo3\": \"{{ $('Edit Fields2').item.json.audiolongo3 }}\",\n\"audiolongo4\": \"{{ $('Edit Fields2').item.json.audiolongo4 }}\",\n\"audiolongo5\": \"{{ $('Edit Fields2').item.json.audiolongo5 }}\",\n\"audiolongo6\": \"{{ $('Edit Fields2').item.json.audiolongo6 }}\",\n\"audiolongo7\": \"{{ $('Edit Fields2').item.json.audiolongo7 }}\",\n\"audiolongo8\": \"{{ $('Edit Fields2').item.json.audiolongo8 }}\",\n\"audiolongo9\": \"{{ $('Edit Fields2').item.json.audiolongo9 }}\",\n\"audiolongo10\": \"{{ $('Edit Fields2').item.json.audiolongo10 }}\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-5460,180],"id":"b795fcfe-453a-49d0-a175-d06725314905","name":"Formatar Saída Estruturada"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-5220,-60],"id":"becb2d6f-ef72-4845-b7a2-9203d6dd90b6","name":"Consolidar Dados do Cartão"},{"parameters":{"resource":"folder","name":"Imagens","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"={{ $json.output[0].pasta }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-5000,-60],"id":"e760df43-0ea8-44c8-b04d-779aa57cd5fb","name":"Criar Pasta para Imagens no Drive","credentials":{"googleDriveOAuth2Api":{"id":"MSZRoiDNJgTmkPcW","name":"Google Drive account 2"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"GPT-4.1-MINI"},"messages":{"values":[{"content":"=Create a prompt for ChatGPT to create an image like a professional photograph based on the theme: {{ $item(\"0\").$node[\"Consolidar Dados do Cartão\"].json[\"output\"][\"0\"][\"título\"] }}. Show a clear and intense emotional expression [choose one: sadness/joy/anger/surprise/fear] appropriate to the title's context. Use lighting that highlights the main subject. Keep the realistic style with vivid colors. No text in the image. High resolution. Provide only the prompt. Return the text without double quotes, with a maximum of 300 characters, clearly and objectively."}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-4780,-60],"id":"e395da7f-2e2a-439c-b2ef-9c8e8103352d","name":"Gerar Descrição para Imagem","credentials":{"openAiApi":{"id":"n4WalwSU2foIXybD","name":"OpenAi account"}}},{"parameters":{"assignments":{"assignments":[{"id":"ff5f86c0-dc5e-43d6-9990-9d264d447804","name":"message.content0","value":"={{ $json.message.content }}","type":"string"},{"id":"70b3db8c-461c-4c13-97a5-ca51cddb293c","name":"message.content1","value":"={{ $json.message.content }}","type":"string"},{"id":"d9a6e1ae-34af-4cc5-8bdd-a7733f563dcd","name":"message.content2","value":"={{ $json.message.content }}","type":"string"},{"id":"294ac06b-3269-488f-9330-5f9b45e38c2c","name":"message.content3","value":"={{ $json.message.content }}","type":"string"},{"id":"05542c2a-a8fb-49e6-8697-79767754b75e","name":"message.content4","value":"={{ $json.message.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4400,-60],"id":"b12c6888-151c-4a92-a2c8-7fbd949b260e","name":"Preparar Múltiplas Descrições"},{"parameters":{"fieldToSplitOut":"message","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-4180,-60],"id":"243ecb47-b98c-4a9e-9c3d-454f7e14c071","name":"Separar Descrições Individuais"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-3960,-60],"id":"e3bb563a-5a77-4179-bd69-dd689655c382","name":"Processar Cada Descrição"},{"parameters":{"method":"POST","url":"https://api.together.xyz/v1/chat/completions","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $item(\"0\").$node[\"Edit Fields\"].json[\"Together API Key\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"black-forest-labs/FLUX.1-schnell\",\n  \"prompt\": {{ JSON.stringify($json.message) }},\n  \"width\": 1280,\n  \"height\": 720,\n  \"steps\": 4,\n  \"n\": 1,\n  \"response_format\": \"b64_json\"\n}","options":{"batching":{"batch":{"batchSize":2,"batchInterval":10000}}}},"id":"1d1791f0-b999-497f-a76b-ddca52b0d13b","name":"Solicitar Imagem à Together.xyz","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3740,-60]},{"parameters":{"operation":"toBinary","sourceProperty":"output.choices[0].image_base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-3520,-60],"id":"20b323bf-87f7-4447-a7db-0c8ece0786e1","name":"Converter Base64 para Arquivo"},{"parameters":{"operation":"text","text":"={{ $('Selecionar Próximo Cartão da Fila').item.json.name }}","fontSize":50,"fontColor":"#FFFFFF","positionX":40,"positionY":80,"options":{"font":"/usr/share/fonts/truetype/msttcorefonts/Arial_Bold.ttf","format":"jpeg"}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[-3300,-60],"id":"c33a8ddb-6f23-4fb6-8b38-2c91634fa8f0","name":"Adicionar Marca d'água"},{"parameters":{"name":"img","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"={{ $('Criar Pasta para Imagens no Drive').item.json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-3080,-60],"id":"77103dbd-1961-4f02-975d-85040350b919","name":"Salvar Imagem no Google Drive","credentials":{"googleDriveOAuth2Api":{"id":"MSZRoiDNJgTmkPcW","name":"Google Drive account 2"}}},{"parameters":{"amount":8},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-2860,20],"id":"65259df3-c06e-4c8b-b780-61e7cf54ee99","name":"Aguardar Processamento","webhookId":"c4ab4086-3d61-4f62-a591-1f100d079f89"},{"parameters":{"fieldToSplitOut":"id","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-3740,-260],"id":"f766cf30-f065-4bb9-95c0-5d5e0b6b8c3c","name":"Separar IDs das Imagens"},{"parameters":{"aggregate":"={{ $json.id }}","fieldsToAggregate":{"fieldToAggregate":[{}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-3520,-260],"id":"a5b2d966-ef1d-4cda-be05-a03edbf5e08d","name":"Agrupar IDs de Imagens"},{"parameters":{"assignments":{"assignments":[{"id":"a17bebb8-7f04-4f2e-bdd7-a6e4be63b784","name":"img1","value":"={{ $json.data[0].id }}","type":"string"},{"id":"4af0684d-d1f5-4ff2-abfa-bebb37541b38","name":"img2","value":"={{ $json.data[1].id }}","type":"string"},{"id":"06d07776-31a3-4d16-96ca-dc3921f38d72","name":"img3","value":"={{ $json.data[2].id }}","type":"string"},{"id":"c5578725-5ab1-4791-84fc-33cc240d7334","name":"img4","value":"={{ $json.data[3].id }}","type":"string"},{"id":"b81e2d42-39c3-4473-bb46-1de60302bbec","name":"img5","value":"={{ $json.data[4].id }}","type":"string"},{"id":"2bef0356-8b6a-4157-a38c-4dce875aff69","name":"img6","value":"={{ $json.data[5].id }}","type":"string"},{"id":"eafad461-9b99-4aa0-b7e5-68aff9c82a8a","name":"img7","value":"={{ $json.data[6].id }}","type":"string"},{"id":"db040239-d6c0-47e4-9515-dd4fcaad7f76","name":"img8","value":"={{ $json.data[7].id }}","type":"string"},{"id":"1028a556-10a5-4b79-b198-f95622eabef7","name":"img9","value":"={{ $json.data[8].id }}","type":"string"},{"id":"5044bbf1-0d4c-447b-bd2a-92ab1d361ce9","name":"img10","value":"={{ $json.data[9].id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3300,-260],"id":"a19e5a15-4547-4d01-9083-4e5dfb4ddc75","name":"Formatar IDs para Trello"},{"parameters":{"operation":"get","id":{"__rl":true,"value":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão da Fila\"].json[\"id\"] }}","mode":"id"},"additionalFields":{}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-3080,-260],"id":"f30959b7-6362-4fc0-83fb-9ee89b8a8a83","name":"Carregar Detalhes do Cartão","credentials":{"trelloApi":{"id":"rpm3uMep21rqpid6","name":"Trello account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"updateFields":{"desc":"={{ $json.desc }}\n\"img1\": \"{{ $('Formatar IDs para Trello').item.json.img1 }}\",\n\"img2\": \"{{ $('Formatar IDs para Trello').item.json.img2 }}\",\n\"img3\": \"{{ $('Formatar IDs para Trello').item.json.img3 }}\",\n\"img4\": \"{{ $('Formatar IDs para Trello').item.json.img4 }}\",\n\"img5\": \"{{ $('Formatar IDs para Trello').item.json.img5 }}\","}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-2860,-260],"id":"db00ca69-4289-4474-92e3-c7a946d8d064","name":"Atualizar Cartão com Links das Imagens","credentials":{"trelloApi":{"id":"rpm3uMep21rqpid6","name":"Trello account"}}},{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[-6920,320],"id":"82fe3f48-282a-49b7-a318-1cd90747db7c","name":"Detector de Falhas"},{"parameters":{"chatId":"-1002592249391","text":"=06 - CRIA IMAGENS - (MILIONARIO)","additionalFields":{"appendAttribution":false,"message_thread_id":3}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-6700,320],"id":"84e67db0-0380-4873-ad46-385a5dffde93","name":"Notificação de Erro no Telegram","webhookId":"69e81cf7-6366-4150-8ea9-0179f2447587","credentials":{"telegramApi":{"id":"Yzfja37I19IMlPgq","name":"Telegram account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão da Fila\"].json[\"id\"] }}","mode":""},"updateFields":{"idList":"={{ $item(\"0\").$node[\"Edit Fields\"].json[\"IMAGENS\"] }}"}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-2640,-260],"id":"61d21996-6cce-44e9-9494-da241f04d01c","name":"Mover Cartão para \"IMAGENS ✅\"","credentials":{"trelloApi":{"id":"rpm3uMep21rqpid6","name":"Trello account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"015448b3-2848-46c1-92d6-cc3f867bbed1","leftValue":"={{ $json.name }}","rightValue":"\"STOP\"","operator":{"type":"string","operation":"notContains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-6260,-60],"id":"a307900f-d08b-4a06-981d-b1b37c09d56b","name":"Exclui Cards em \"STOP\""},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"updateFields":{"name":"={{ $json.name }} \"STOP\""}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-5820,-60],"id":"e460780c-9ef5-4c27-ba80-8f827639f083","name":"Atualizar Cartão com \"STOP\"","credentials":{"trelloApi":{"id":"rpm3uMep21rqpid6","name":"Trello account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"updateFields":{"name":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão da Fila\"].json[\"name\"] }}"}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-2420,-260],"id":"dcfaafb7-963e-4470-a22f-af5ff51350c2","name":"Remove \"STOP\"","credentials":{"trelloApi":{"id":"rpm3uMep21rqpid6","name":"Trello account"}}},{"parameters":{"assignments":{"assignments":[{"id":"948aa1b6-75d6-4cf6-9cd1-629b97a571d6","name":"ÁUDIOS LONGOS","value":"682d2fb01bbf167e01b89da3","type":"string"},{"id":"41fb9577-343d-439a-bacf-65018b3f194c","name":"IMAGENS","value":"682d2fb01bbf167e01b89da0","type":"string"},{"id":"f42a20f1-0812-4b36-bd40-5d779ca6e7ad","name":"Together API Key","value":"c40c927bd63afd6848932f40073ff0d92f318fc44a9e9b567c96badb7dd45287","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6700,-60],"id":"edd08ef7-5f7e-4121-a078-500003761ff7","name":"Edit Fields"}],"connections":{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Extrair Dados do Cartão","type":"ai_languageModel","index":0}]]},"Iniciar Verificação Periódica":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Buscar Cartões com Solicitações de Imagem":{"main":[[{"node":"Exclui Cards em \"STOP\"","type":"main","index":0}]]},"Selecionar Próximo Cartão da Fila":{"main":[[{"node":"Atualizar Cartão com \"STOP\"","type":"main","index":0}]]},"Extrair Dados do Cartão":{"main":[[{"node":"Consolidar Dados do Cartão","type":"main","index":0}]]},"Formatar Saída Estruturada":{"ai_outputParser":[[{"node":"Extrair Dados do Cartão","type":"ai_outputParser","index":0}]]},"Consolidar Dados do Cartão":{"main":[[{"node":"Criar Pasta para Imagens no Drive","type":"main","index":0}]]},"Criar Pasta para Imagens no Drive":{"main":[[{"node":"Gerar Descrição para Imagem","type":"main","index":0}]]},"Gerar Descrição para Imagem":{"main":[[{"node":"Preparar Múltiplas Descrições","type":"main","index":0}]]},"Preparar Múltiplas Descrições":{"main":[[{"node":"Separar Descrições Individuais","type":"main","index":0}]]},"Separar Descrições Individuais":{"main":[[{"node":"Processar Cada Descrição","type":"main","index":0}]]},"Processar Cada Descrição":{"main":[[{"node":"Separar IDs das Imagens","type":"main","index":0}],[{"node":"Solicitar Imagem à Together.xyz","type":"main","index":0}]]},"Solicitar Imagem à Together.xyz":{"main":[[{"node":"Converter Base64 para Arquivo","type":"main","index":0}]]},"Converter Base64 para Arquivo":{"main":[[{"node":"Adicionar Marca d'água","type":"main","index":0}]]},"Adicionar Marca d'água":{"main":[[{"node":"Salvar Imagem no Google Drive","type":"main","index":0}]]},"Salvar Imagem no Google Drive":{"main":[[{"node":"Aguardar Processamento","type":"main","index":0}]]},"Aguardar Processamento":{"main":[[{"node":"Processar Cada Descrição","type":"main","index":0}]]},"Separar IDs das Imagens":{"main":[[{"node":"Agrupar IDs de Imagens","type":"main","index":0}]]},"Agrupar IDs de Imagens":{"main":[[{"node":"Formatar IDs para Trello","type":"main","index":0}]]},"Formatar IDs para Trello":{"main":[[{"node":"Carregar Detalhes do Cartão","type":"main","index":0}]]},"Carregar Detalhes do Cartão":{"main":[[{"node":"Atualizar Cartão com Links das Imagens","type":"main","index":0}]]},"Atualizar Cartão com Links das Imagens":{"main":[[{"node":"Mover Cartão para \"IMAGENS ✅\"","type":"main","index":0}]]},"Detector de Falhas":{"main":[[{"node":"Notificação de Erro no Telegram","type":"main","index":0}]]},"Mover Cartão para \"IMAGENS ✅\"":{"main":[[{"node":"Remove \"STOP\"","type":"main","index":0}]]},"Exclui Cards em \"STOP\"":{"main":[[{"node":"Selecionar Próximo Cartão da Fila","type":"main","index":0}]]},"Atualizar Cartão com \"STOP\"":{"main":[[{"node":"Extrair Dados do Cartão","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Buscar Cartões com Solicitações de Imagem","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Iniciar Verificação Periódica":{"recurrenceRules":[]}},"meta":null,"pinData":{},"versionId":"4bc178b6-da9e-48cf-8408-8a722f22e858","triggerCount":1,"tags":[]}